<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enhanced Graph Creator with Trig Functions & More Charts</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Chart.js and plugins -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.2.1/dist/chartjs-plugin-zoom.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.1.0/dist/chartjs-plugin-annotation.min.js"></script>
    <!-- Brython -->
    <script src="https://cdn.jsdelivr.net/npm/brython@3.10.5/brython.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.10.5/brython_stdlib.js"></script>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        background: linear-gradient(135deg, #2b1055, #7597de);
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
        color: #fff;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
      }
      
      /* Add animated background elements */
      body::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><circle cx="30" cy="30" r="20" fill="rgba(255,255,255,0.03)"/><circle cx="70" cy="70" r="30" fill="rgba(255,255,255,0.02)"/></svg>');
        background-size: 100px 100px;
        opacity: 0.5;
        animation: backgroundMove 60s linear infinite;
      }
      
      @keyframes backgroundMove {
        0% { background-position: 0 0; }
        100% { background-position: 100px 100px; }
      }
      
      .container {
        display: flex;
        width: 95%;
        height: 95%;
        max-width: 1400px;
        border-radius: 24px;
        overflow: hidden;
        padding: 8px;
        background: linear-gradient(135deg, #6a3093, #a044ff);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4),
                   inset 0 2px 10px rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        position: relative;
        z-index: 10;
        animation: containerGlow 5s ease-in-out infinite alternate;
      }
      
      @keyframes containerGlow {
        0% { box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), inset 0 2px 10px rgba(255, 255, 255, 0.2); }
        100% { box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), 0 0 20px rgba(160, 68, 255, 0.6), inset 0 2px 10px rgba(255, 255, 255, 0.2); }
      }
      
      .content-wrapper {
        display: flex;
        width: 100%;
        height: 100%;
        background: linear-gradient(to right, rgba(20, 20, 31, 0.95), rgba(30, 30, 45, 0.95));
        border-radius: 18px;
        overflow: hidden;
        box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.07);
        position: relative;
      }
      
      /* Add subtle grid pattern to content-wrapper */
      .content-wrapper::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        background-image: 
          linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
          linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        background-size: 20px 20px;
        z-index: -1;
      }
      .graph-panel {
        flex: 2.3;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        background: linear-gradient(145deg, #131313, #1d1d1d);
        border-radius: 12px;
        box-shadow: inset 0 0 40px rgba(0, 0, 0, 0.5);
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.05);
      }
      
      /* Add subtle animated glow to graph panel */
      .graph-panel::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(160, 68, 255, 0.5), transparent);
        animation: glowScan 4s ease-in-out infinite;
      }
      
      @keyframes glowScan {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }
      
      .graph-header {
        padding: 17px 25px;
        font-weight: bold;
        font-size: 1.1rem;
        letter-spacing: 1px;
        backdrop-filter: blur(10px);
        background: linear-gradient(90deg, rgba(106, 48, 147, 0.2), rgba(160, 68, 255, 0.2));
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
        display: flex;
        align-items: center;
        text-transform: uppercase;
        color: #fff;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }
      
      /* Add icon to graph header */
      .graph-header::before {
        content: "📊";
        margin-right: 10px;
        font-size: 1.2rem;
      }
      
      .graph-content {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        background: rgba(24, 24, 24, 0.7);
        border-radius: 0 0 12px 12px;
        position: relative;
        transition: all 0.3s ease;
      }
      
      .graph-content:hover {
        box-shadow: inset 0 0 20px rgba(160, 68, 255, 0.1);
      }
      
      /* Add subtle grid to graph content */
      .graph-content::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
          radial-gradient(circle, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        background-size: 20px 20px;
        opacity: 0.5;
        pointer-events: none;
        z-index: 0;
      }
      .input-panel {
        flex: 1;
        background: #1e1e1e;
        padding: 18px;
        overflow-y: auto;
        font-family: "Fira Code", monospace;
        font-size: 14px;
        line-height: 1.5;
      }
      .input-header {
        margin-bottom: 13px;
        color: #9e86ff;
        font-weight: bold;
      }
      .panel {
        display: none;
        flex-direction: column;
      }
      .panel.active {
        display: flex;
      }
      .form-label {
        margin-bottom: 0.5rem;
        display: block;
        color: #fff;
      }
      .form-control {
        width: 100%;
        padding: 10px;
        border-radius: 4px;
        background-color: #2a2a2a;
        border: 1px solid #444;
        color: #fff;
        outline: none;
        margin-bottom: 1rem;
      }
      .btn {
        border: none;
        padding: 12px 20px;
        font-size: 16px;
        border-radius: 8px;
        color: #fff;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        align-self: center;
        margin-top: 1rem;
      }
      .btn-primary {
        background: linear-gradient(90deg, #4caf50, #81c784);
      }
      .btn-primary:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 20px rgba(76, 175, 80, 0.6);
      }
      .btn-secondary {
        background: linear-gradient(90deg, #ff8a80, #ff5252);
      }
      .btn-secondary:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 20px rgba(255, 82, 82, 0.6);
      }
      canvas {
        max-width: 100%;
        max-height: 100%;
        border-radius: 11px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }
      .accordion-button {
        background-color: #343a40;
        color: #fff;
      }
      .accordion-button:not(.collapsed) {
        background-color: #495057;
        color: #fff;
      }
      .accordion-body {
        background-color: #495057;
        color: #fff;
      }
      #moreOptionsContainer {
        margin-top: 20px;
      }
      @media (max-width: 768px) {
        .content-wrapper {
          flex-direction: column;
        }
        .graph-panel, .input-panel {
          flex: 1;
          height: 50%;
        }
      }
      .custom-nav {
        display: flex;
        justify-content: space-around;
        background: linear-gradient(135deg, #1a1a2e, #2a2a4a);
        padding: 12px 15px;
        border-radius: 15px;
        margin-bottom: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2),
                   inset 0 1px 2px rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      .custom-nav button {
        background: rgba(26, 26, 46, 0.6);
        color: #ffffff;
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 12px 25px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        font-family: "Fira Code", monospace;
        letter-spacing: 0.5px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(5px);
        text-transform: uppercase;
        font-size: 13px;
      }

      .custom-nav button.active {
        background: linear-gradient(135deg, #9e86ff, #4c2c8c);
        color: #ffffff;
        box-shadow: 0 4px 15px rgba(158, 134, 255, 0.3);
        transform: translateY(-1px);
      }

      .custom-nav button:hover {
        background: linear-gradient(135deg, #4c2c8c, #2c1f3a);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(76, 44, 140, 0.4);
      }
            /* Add these styles to your existing CSS */
            .function-select-wrapper {
        background: linear-gradient(145deg, #1e1e1e, #2a2a2a);
        border-radius: 12px;
        padding: 15px;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.05);
        margin-bottom: 20px;
      }

      .function-select-label {
        color: #9e86ff;
        font-size: 0.95rem;
        font-weight: 600;
        margin-bottom: 12px;
        letter-spacing: 0.5px;
        text-transform: uppercase;
      }

      .function-select {
        background: rgba(26, 26, 46, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 12px;
        color: #fff;
        font-family: "Fira Code", monospace;
        font-size: 14px;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
      }

      .function-select:hover {
        border-color: rgba(158, 134, 255, 0.4);
        box-shadow: 0 0 15px rgba(158, 134, 255, 0.1);
      }

      .function-select:focus {
        border-color: #9e86ff;
        box-shadow: 0 0 0 2px rgba(158, 134, 255, 0.2);
        outline: none;
      }

      .function-select option {
        background: #1a1a2e;
        color: #fff;
        padding: 10px;
      }
      .app-title {
        text-align: center;
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 25px;
        background: linear-gradient(135deg, #9e86ff, #4c2c8c);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        letter-spacing: 1px;
      }
      .chart-type-wrapper {
        background: linear-gradient(145deg, #1e1e1e, #2a2a2a);
        border-radius: 12px;
        padding: 20px;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.05);
        margin-bottom: 20px;
      }

      .chart-type-label {
        color: #9e86ff;
        font-size: 0.95rem;
        font-weight: 600;
        margin-bottom: 12px;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .chart-type-label::before {
        content: "📊";
        font-size: 1.2rem;
      }

      .chart-type-select {
        background: rgba(26, 26, 46, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 12px;
        color: #fff;
        font-family: "Fira Code", monospace;
        font-size: 14px;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
        width: 100%;
        cursor: pointer;
      }

      .chart-type-select:hover {
        border-color: rgba(158, 134, 255, 0.4);
        box-shadow: 0 0 15px rgba(158, 134, 255, 0.1);
        transform: translateY(-1px);
      }

      .chart-type-select:focus {
        border-color: #9e86ff;
        box-shadow: 0 0 0 2px rgba(158, 134, 255, 0.2);
        outline: none;
      }

      .chart-type-select option {
        background: #1a1a2e;
        color: #fff;
        padding: 12px;
        font-size: 14px;
      }
      
      /* Implicit Function Program Overlay */
      .implicit-program-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #2b1055, #7597de);
        z-index: 1000;
        display: none;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
        overflow: hidden;
      }
      
      .implicit-program-container {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        padding: 20px;
      }
      
      .implicit-program-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }
      
      .implicit-program-title {
        font-size: 1.8rem;
        font-weight: 600;
        color: #fff;
        background: linear-gradient(135deg, #9e86ff, #4c2c8c);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      }
      
      .implicit-back-btn {
        background: linear-gradient(90deg, #ff8a80, #ff5252);
        border: none;
        color: white;
        padding: 10px 20px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(255, 82, 82, 0.3);
      }
      
      .implicit-back-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 82, 82, 0.5);
      }
      
      .implicit-program-content {
        position: relative;
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
      }
      
      .implicit-program-iframe {
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 12px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        z-index: 5;
      }
      
      /* Animation classes */
      .fade-in {
        display: block;
        animation: fadeIn 0.5s forwards;
      }
      
      .fade-out {
        animation: fadeOut 0.5s forwards;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      
      @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; display: none; }
      }
      
      /* Loading spinner styles */
      .loading-spinner-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: rgba(43, 16, 85, 0.9);
        color: white;
        z-index: 10;
        border-radius: 12px;
        transition: opacity 0.5s ease;
      }
      
      .loading-spinner-container h3 {
        margin-bottom: 20px;
        font-size: 1.5rem;
        color: #fff;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        background: linear-gradient(135deg, #9e86ff, #4c2c8c);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      
      .loading-spinner {
        width: 60px;
        height: 60px;
        border: 5px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top: 5px solid #9e86ff;
        animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .loading-hidden {
        opacity: 0;
        pointer-events: none;
      }
    </style>
  </head>
  <body onload="brython()">
    <div class="container">
      <div class="content-wrapper">
        <!-- Graph Display Panel -->
        <div class="graph-panel">
          <div class="graph-header">Graph Display</div>
          <div class="graph-content">
            <canvas id="myChart"></canvas>
          </div>
        </div>
        <div class="input-panel">
            <h1 class="app-title">ABS Graph Creator</h1>
            <div class="input-header">Graph Creator</div>
        <!-- Input Panel -->
        <div class="input-panel">
          <div class="input-header">Graph Creator</div>
          <div class="custom-nav" id="modeTabs">
            <button class="active" id="data-tab" data-target="#dataPanel">Data</button>
            <button id="equation-tab" data-target="#equationPanel">Equation</button>
          </div>
          
          <!-- Data Entry Panel -->
          <div id="dataPanel" class="panel active">
            <h2>Enter Data</h2>
            <div class="mb-3">
              <label for="xValues" class="form-label">X-axis values:</label>
              <input type="text" id="xValues" class="form-control" placeholder="e.g. 1, 2, 3, 4 or A, B, C, D" />
            </div>
            <div class="mb-3">
              <label for="yValues" class="form-label">Y-axis values:</label>
              <input type="text" id="yValues" class="form-control" placeholder="e.g. 10, 20, 30, 40 or W, X, Y, Z" />
            </div>
            <button id="createBtn" class="btn btn-primary">Create Graph</button>
            <button id="clearDataBtn" class="btn btn-secondary">Clear Graph</button>
          </div>
          <!-- Equation Entry Panel -->
          <div id="equationPanel" class="panel">
            <h2>Enter Equation</h2>
            <div class="mb-3">
              <label for="equation" class="form-label">Equation (in terms of x):</label>
              <input type="text" id="equation" class="form-control" placeholder="e.g. x**2 + 2*x + 1" />
            </div>
            <div class="mb-3 function-select-wrapper">
                <label for="trigFunction" class="form-label function-select-label">Select a Function</label>
                <select id="trigFunction" class="form-control function-select">
                  <option value="">-- Select Function --</option>
                  <option value="math.sin(x)">sin(x)</option>
                  <option value="math.cos(x)">cos(x)</option>
                  <option value="math.tan(x)">tan(x)</option>
                  <option value="math.log(x)">log(x)</option>
                  <option value="math.exp(x)">exp(x)</option>
                  <option value="math.sqrt(x)">sqrt(x)</option>
                  <option value="abs(x)">abs(x)</option>
                  <option value="math.pow(x, 2)">x²</option>
                </select>
              </div>
            <div class="mb-3">
              <label for="startX" class="form-label">Start x:</label>
              <input type="text" id="startX" class="form-control" placeholder="e.g. -10" />
            </div>
            <div class="mb-3">
              <label for="endX" class="form-label">End x:</label>
              <input type="text" id="endX" class="form-control" placeholder="e.g. 10" />
            </div>
            <button id="createEquationBtn" class="btn btn-primary">Create Graph</button>
            <button id="clearEquationBtn" class="btn btn-secondary">Clear Graph</button>
            <div class="accordion mt-3" id="equationAdditionalAccordion">
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingAdditional">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAdditional" aria-expanded="false" aria-controls="collapseAdditional">
                    Additional Equation Features
                  </button>
                </h2>
                <div id="collapseAdditional" class="accordion-collapse collapse" aria-labelledby="headingAdditional" data-bs-parent="#equationAdditionalAccordion">
                  <div class="accordion-body">
                    <h5>Interactive Parameter Sliders</h5>
                    <div class="mb-3">
                      <label for="paramA" class="form-label">Coefficient a:</label>
                      <input type="range" id="paramA" class="form-range" min="-10" max="10" step="0.1" value="1" />
                      <span id="paramAValue">1</span>
                    </div>
                    <div class="mb-3">
                      <label for="paramB" class="form-label">Coefficient b:</label>
                      <input type="range" id="paramB" class="form-range" min="-10" max="10" step="0.1" value="0" />
                      <span id="paramBValue">0</span>
                    </div>
                    <div class="mb-3">
                      <label for="paramC" class="form-label">Coefficient c:</label>
                      <input type="range" id="paramC" class="form-range" min="-10" max="10" step="0.1" value="0" />
                      <span id="paramCValue">0</span>
                    </div>
                    <button id="updateEquationWithParams" class="btn btn-primary">Update Equation</button>
                    <hr />
                    <h5>Implicit and Parametric Equations</h5>
                    <div class="mb-3">
                      <label class="form-label">Equation Type:</label>
                      <select id="equationType" class="form-control">
                        <option value="explicit" selected>Explicit (y = f(x))</option>
                        <option value="implicit">Implicit (F(x,y)=0)</option>
                        <option value="parametric">Parametric (x(t), y(t))</option>
                      </select>
                    </div>
                    <div id="parametricInputs" style="display: none;">
                      <div class="mb-3">
                        <label for="parametricX" class="form-label">x(t):</label>
                        <input type="text" id="parametricX" class="form-control" placeholder="e.g. cos(t)" />
                      </div>
                      <div class="mb-3">
                        <label for="parametricY" class="form-label">y(t):</label>
                        <input type="text" id="parametricY" class="form-control" placeholder="e.g. sin(t)" />
                      </div>
                      <div class="mb-3">
                        <label for="startT" class="form-label">Start t:</label>
                        <input type="text" id="startT" class="form-control" placeholder="e.g. 0" />
                      </div>
                      <div class="mb-3">
                        <label for="endT" class="form-label">End t:</label>
                        <input type="text" id="endT" class="form-control" placeholder="e.g. 6.28" />
                      </div>
                    </div>
                    <div id="implicitInput" style="display: none;">
                      <div class="mb-3">
                        <label for="implicitEquation" class="form-label">Implicit Equation (F(x,y)=0):</label>
                        <input type="text" id="implicitEquation" class="form-control" placeholder="e.g. x**2 + y**2 - 1" />
                      </div>
                      <div class="mb-3">
                        <label for="startXImplicit" class="form-label">Start x:</label>
                        <input type="text" id="startXImplicit" class="form-control" placeholder="e.g. -10" />
                      </div>
                      <div class="mb-3">
                        <label for="endXImplicit" class="form-label">End x:</label>
                        <input type="text" id="endXImplicit" class="form-control" placeholder="e.g. 10" />
                      </div>
                      <div class="mb-3">
                        <label for="startY" class="form-label">Start y:</label>
                        <input type="text" id="startY" class="form-control" placeholder="e.g. -1.5" />
                      </div>
                      <div class="mb-3">
                        <label for="endY" class="form-label">End y:</label>
                        <input type="text" id="endY" class="form-control" placeholder="e.g. 1.5" />
                      </div>
                    </div>
                    <hr />
                    <h5>Animation and Transformations</h5>
                    <div class="mb-3">
                      <label for="enableAnimation" class="form-label">Enable Animated Transitions:</label>
                      <input type="checkbox" id="enableAnimation" class="form-check-input" />
                    </div>
                    <div class="mb-3">
                      <label for="enableTransform" class="form-label">Show Transformations:</label>
                      <input type="checkbox" id="enableTransform" class="form-check-input" />
                    </div>
                    <button id="plotAdditionalBtn" class="btn btn-primary">Plot Equation</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- More Options Container (Data Mode) -->
          <div id="moreOptionsContainer">
            <div class="accordion" id="moreOptionsAccordion">
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingCustomization">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCustomization" aria-expanded="false" aria-controls="collapseCustomization">
                    Customization
                  </button>
                </h2>
                <div id="collapseCustomization" class="accordion-collapse collapse" aria-labelledby="headingCustomization" data-bs-parent="#moreOptionsAccordion">
                  <div class="accordion-body">
                    <div class="mb-3">
                      <label for="xAxisType" class="form-label">X Axis Data Type:</label>
                      <select id="xAxisType" class="form-control">
                        <option value="Numeric" selected>Numeric</option>
                        <option value="Alphabetic">Alphabetic</option>
                      </select>
                    </div>
                    <div class="mb-3">
                      <label for="yAxisType" class="form-label">Y Axis Data Type:</label>
                      <select id="yAxisType" class="form-control">
                        <option value="Numeric" selected>Numeric</option>
                        <option value="Alphabetic">Alphabetic</option>
                      </select>
                    </div>
                    <div class="mb-3 chart-type-wrapper">
                      <label for="chartType" class="form-label chart-type-label">Chart Type</label>
                      <select id="chartType" class="form-control chart-type-select">
                          <option value="line" selected>📈 Line Chart</option>
                          <option value="bar">📊 Bar Chart</option>
                          <option value="scatter">🔵 Scatter Plot</option>
                          <option value="area">📉 Area Chart</option>
                          <option value="horizontalBar">📊 Horizontal Bar</option>
                          <option value="pie">🥧 Pie Chart</option>
                      </select>
                  </div>
                    <div class="mb-3">
                      <label for="chartTitle" class="form-label">Chart Title:</label>
                      <input type="text" id="chartTitle" class="form-control" placeholder="Enter Chart Title" />
                    </div>
                    <div class="mb-3">
                      <label for="xAxisLabel" class="form-label">X Axis Label:</label>
                      <input type="text" id="xAxisLabel" class="form-control" placeholder="Enter X Axis Label" />
                    </div>
                    <div class="mb-3">
                      <label for="yAxisLabel" class="form-label">Y Axis Label:</label>
                      <input type="text" id="yAxisLabel" class="form-control" placeholder="Enter Y Axis Label" />
                    </div>
                    <div class="mb-3">
                      <label for="datasetColor" class="form-label">Dataset Color:</label>
                      <input type="color" id="datasetColor" class="form-control" value="#4caf50" />
                    </div>
                    <div class="mb-3">
                      <label for="borderColor" class="form-label">Border Color:</label>
                      <input type="color" id="borderColor" class="form-control" value="#4caf50" />
                    </div>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingFileOps">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFileOps" aria-expanded="false" aria-controls="collapseFileOps">
                    File Operations
                  </button>
                </h2>
                <div id="collapseFileOps" class="accordion-collapse collapse" aria-labelledby="headingFileOps" data-bs-parent="#moreOptionsAccordion">
                  <div class="accordion-body">
                    <div class="mb-3">
                      <label for="dataFileInput" class="form-label">Import Data File (CSV/JSON):</label>
                      <input type="file" id="dataFileInput" class="form-control" accept=".csv, .json" />
                    </div>
                    <div class="mb-3">
                      <button id="exportBtn" class="btn btn-primary">Export Graph</button>
                      <button id="resetZoomBtn" class="btn btn-secondary">Reset Zoom</button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingAnalysis">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAnalysis" aria-expanded="false" aria-controls="collapseAnalysis">
                    Analysis Tools
                  </button>
                </h2>
                <div id="collapseAnalysis" class="accordion-collapse collapse" aria-labelledby="headingAnalysis" data-bs-parent="#moreOptionsAccordion">
                  <div class="accordion-body">
                    <div class="mb-3">
                      <button id="analyzeDataBtn" class="btn btn-primary">Analyze Data</button>
                      <button id="addRegressionBtn" class="btn btn-secondary">Add Regression Line</button>
                    </div>
                    <div id="analysisResults" class="mb-3" style="background: #2a2a2a; padding: 10px; border-radius: 5px;"></div>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingAnnotations">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAnnotations" aria-expanded="false" aria-controls="collapseAnnotations">
                    Annotations
                  </button>
                </h2>
                <div id="collapseAnnotations" class="accordion-collapse collapse" aria-labelledby="headingAnnotations" data-bs-parent="#moreOptionsAccordion">
                  <div class="accordion-body">
                    <div class="mb-3">
                      <label for="annotationX" class="form-label">Annotation X:</label>
                      <input type="text" id="annotationX" class="form-control" placeholder="Enter X value for annotation" />
                    </div>
                    <div class="mb-3">
                      <label for="annotationLabel" class="form-label">Annotation Label:</label>
                      <input type="text" id="annotationLabel" class="form-control" placeholder="Enter annotation label" />
                    </div>
                    <div class="mb-3">
                      <button id="addAnnotationBtn" class="btn btn-primary">Add Annotation</button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingDataTools">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDataTools" aria-expanded="false" aria-controls="collapseDataTools">
                    Data Tools
                  </button>
                </h2>
                <div id="collapseDataTools" class="accordion-collapse collapse" aria-labelledby="headingDataTools" data-bs-parent="#moreOptionsAccordion">
                  <div class="accordion-body">
                    <div class="mb-3">
                      <button id="viewDataTableBtn" class="btn btn-primary">View Data Table</button>
                    </div>
                    <div id="dataTableContainer" style="display: none; background: #2a2a2a; padding: 10px; border-radius: 5px; margin-bottom: 1rem;"></div>
                    <div class="mb-3">
                      <button id="downloadCSVBtn" class="btn btn-primary">Download Data as CSV</button>
                    </div>
                    <div class="mb-3">
                      <button id="saveConfigBtn" class="btn btn-primary">Save Chart Config</button>
                      <button id="loadConfigBtn" class="btn btn-secondary">Load Chart Config</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Implicit Function Program Overlay -->
    <div id="implicitProgramOverlay" class="implicit-program-overlay">
      <div class="implicit-program-container">
        <div class="implicit-program-header">
          <div class="implicit-program-title">Implicit Function Explorer</div>
          <button id="implicitBackBtn" class="implicit-back-btn">← Back to Graph Creator</button>
        </div>
        <div class="implicit-program-content">
          <div id="loadingIndicator" class="loading-spinner-container">
            <h3>Loading Implicit Function Explorer...</h3>
            <div class="loading-spinner"></div>
          </div>
          <iframe id="implicitProgramFrame" class="implicit-program-iframe" src="" 
                  frameborder="0" 
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                  allowfullscreen
                  sandbox="allow-same-origin allow-scripts allow-forms allow-popups"></iframe>
        </div>
      </div>
    </div>

    <!-- Brython Script -->
    <script type="text/python">
      from browser import document, alert, window
      import math, json

      # Clear existing chart
      def clear_chart():
          try:
              window.chart.destroy()
          except Exception:
              pass

      # Build chart configuration
      def build_chart_config(data_points, dataset_label):
          chart_type = document["chartType"].value
          chart_title = document["chartTitle"].value.strip()
          x_axis_label = document["xAxisLabel"].value.strip()
          y_axis_label = document["yAxisLabel"].value.strip()
          dataset_color = document["datasetColor"].value
          border_color = document["borderColor"].value
          x_axis_type = document["xAxisType"].value
          y_axis_type = document["yAxisType"].value
          x_scale_type = "linear" if x_axis_type == "Numeric" else "category"
          y_scale_type = "linear" if y_axis_type == "Numeric" else "category"
          
          # For pie charts, we need to handle colors differently
          if chart_type == "pie":
              # Generate an array of visually distinct colors
              num_segments = len(data_points)
              background_colors = [
                  f"hsl({(i * 360 / num_segments)}, 70%, 50%)"
                  for i in range(num_segments)
              ]
              border_colors = ["rgba(255, 255, 255, 0.8)"] * num_segments  # White borders
              
              config = {
                  "type": "pie",
                  "data": {
                      "labels": [str(point["x"]) for point in data_points],
                      "datasets": [{
                          "data": [point["y"] for point in data_points],
                          "backgroundColor": background_colors,
                          "borderColor": border_colors,
                          "borderWidth": 2
                      }]
                  },
                  "options": {
                      "responsive": True,
                      "plugins": {
                          "legend": {"display": True},
                          "title": {"display": bool(chart_title), "text": chart_title}
                      }
                  }
              }
              return config
          else:
              # For other chart types, use the provided color
              background_colors = dataset_color
              border_colors = border_color
          
          config = {
              "type": chart_type,
              "data": {
                  "datasets": [{
                      "label": dataset_label,
                      "data": data_points,
                      "backgroundColor": background_colors,
                      "borderColor": border_colors,
                      "borderWidth": 2,
                      "pointRadius": 4 if dataset_label == "Data Points" else 0,
                      "fill": False,
                      "tension": 0.3
                  }]
              },
              "options": {
                  "scales": {
                      "x": {"type": x_scale_type, "position": "bottom", "title": {"display": bool(x_axis_label), "text": x_axis_label}},
                      "y": {"type": y_scale_type, "title": {"display": bool(y_axis_label), "text": y_axis_label}}
                  },
                  "plugins": {
                      "legend": {"display": True},
                      "title": {"display": bool(chart_title), "text": chart_title},
                      "zoom": {"zoom": {"enabled": True, "mode": "xy"}, "pan": {"enabled": True, "mode": "xy"}},
                      "annotation": {"annotations": {}}
                  }
              }
          }
          
          # Handle special chart types
          if chart_type == "area":
              config["type"] = "line"
              config["data"]["datasets"][0]["fill"] = True
          elif chart_type == "horizontalBar":
              config["type"] = "bar"
              config["options"]["indexAxis"] = "y"
          elif chart_type == "pie" or chart_type == "doughnut":
              # For pie and doughnut charts, we don't need scales
              config["options"]["scales"] = {}
              
              # Add labels to data if they exist
              if "labels" in document and hasattr(document["labels"], "value"):
                  config["data"]["labels"] = document["labels"].value
              elif isinstance(data_points, list) and all(isinstance(item, dict) and "x" in item for item in data_points):
                  # Extract labels from data points if they're in {x, y} format
                  config["data"]["labels"] = [point["x"] for point in data_points]
                  config["data"]["datasets"][0]["data"] = [point["y"] for point in data_points]
          else:
              config["type"] = chart_type
          
          if "enableAnimation" in document and document["enableAnimation"].checked:
              config["options"]["animation"] = {"duration": 1000}
          else:
              config["options"]["animation"] = {"duration": 0}
          
          if y_axis_type == "Alphabetic" and x_axis_type == "Numeric" and chart_type not in ["horizontalBar", "pie", "doughnut"]:
              config["options"]["indexAxis"] = "y"
          
          return config

      # Apply transformation animation
      def apply_transform_animation():
          try:
              canvas = document["myChart"]
              if "enableTransform" in document and document["enableTransform"].checked:
                  canvas.style.transition = "transform 1s"
                  canvas.style.transform = "scale(1.1)"
                  window.setTimeout(lambda: setattr(canvas.style, "transform", "scale(1)"), 1000)
          except Exception:
              pass

      # Create graph from data input
      def create_graph_data(event):
          x_input = document["xValues"].value
          y_input = document["yValues"].value
          x_axis_type = document["xAxisType"].value
          y_axis_type = document["yAxisType"].value
          chart_type = document["chartType"].value

          if chart_type == "pie":
              try:
                  y_values = [float(y.strip()) for y in y_input.split(',') if y.strip()]
                  if any(y < 0 for y in y_values):
                      alert("Pie charts require positive values only.")
                      return
              except Exception:
                  alert("Invalid Y-axis input. Enter comma-separated positive numbers for pie chart.")
                  return
              x_values = [x.strip() for x in x_input.split(',') if x.strip()]
          else:
              if chart_type == "horizontalBar" and (y_axis_type != "Alphabetic" or x_axis_type != "Numeric"):
                  alert("For Horizontal Bar chart, set Y-axis to Alphabetic and X-axis to Numeric.")
                  return

              if x_axis_type == "Numeric":
                  try:
                      x_values = [float(x.strip()) for x in x_input.split(',') if x.strip()]
                  except Exception:
                      alert("Invalid X-axis input. Enter comma-separated numbers.")
                      return
              else:
                  x_values = [x.strip() for x in x_input.split(',') if x.strip()]

              if y_axis_type == "Numeric":
                  try:
                      y_values = [float(y.strip()) for y in y_input.split(',') if y.strip()]
                  except Exception:
                      alert("Invalid Y-axis input. Enter comma-separated numbers.")
                      return
              else:
                  y_values = [y.strip() for y in y_input.split(',') if y.strip()]

          if len(x_values) != len(y_values):
              alert("X and Y value counts must match.")
              return

          if x_axis_type != "Numeric" and y_axis_type != "Numeric":
              alert("At least one axis must be numeric.")
              return

          data_points = [{"x": x_values[i], "y": y_values[i]} for i in range(len(x_values))]
          clear_chart()
          ctx = document["myChart"].getContext("2d")
          config = build_chart_config(data_points, "Data Points")
          window.chart = window.Chart.new(ctx, config)
          window.dataPoints = data_points
          apply_transform_animation()

      # Create graph from equation
      def create_graph_equation(event):
          eq = document["equation"].value.strip()
          start_str = document["startX"].value.strip()
          end_str = document["endX"].value.strip()
          if not eq or not start_str or not end_str:
              alert("Fill in equation and domain values.")
              return
          try:
              start_x, end_x = float(start_str), float(end_str)
          except Exception:
              alert("Invalid start or end x value.")
              return
          if start_x >= end_x:
              alert("Start x must be less than end x.")
              return

          try:
              def f(x):
                  return eval(eq, {"__builtins__": None, "math": math, "x": x})
              x_values = [start_x + i * (end_x - start_x) / 100 for i in range(101)]
              data_points = []
              for x in x_values:
                  try:
                      y = f(x)
                      if y is not None:
                          data_points.append({"x": x, "y": y})
                  except Exception:
                      pass
          except Exception as e:
              alert(f"Error evaluating equation: {str(e)}")
              return

          clear_chart()
          ctx = document["myChart"].getContext("2d")
          config = build_chart_config(data_points, f"y = {eq}")
          window.chart = window.Chart.new(ctx, config)
          window.dataPoints = data_points
          apply_transform_animation()

      # Insert trigonometric function into equation input
      def insert_trig_function(event):
          func = document["trigFunction"].value
          if func:
              document["equation"].value = func
              document["trigFunction"].value = ""  # Reset dropdown

      # Export graph as PNG
      def export_graph(event):
          try:
              canvas = document["myChart"]
              a = document.createElement("a")
              a.href = canvas.toDataURL("image/png")
              a.download = "graph.png"
              document.body.appendChild(a)
              a.click()
              document.body.removeChild(a)
          except Exception as e:
              alert(f"Error exporting graph: {str(e)}")

      # Reset zoom
      def reset_zoom(event):
          try:
              window.chart.resetZoom()
          except Exception:
              alert("Zoom reset not available.")

      # Import data from file
      def import_data(event):
          file_input = document["dataFileInput"]
          if not file_input.files:
              return
          file = file_input.files[0]
          reader = window.FileReader.new()
          def onload(ev):
              content = reader.result
              if file.name.lower().endswith(".csv"):
                  lines = content.strip().split("\n")
                  x_values, y_values = [], []
                  for line in lines:
                      parts = line.split(",")
                      if len(parts) >= 2:
                          x_values.append(parts[0].strip())
                          y_values.append(parts[1].strip())
                  document["xValues"].value = ", ".join(x_values)
                  document["yValues"].value = ", ".join(y_values)
                  create_graph_data(None)
              elif file.name.lower().endswith(".json"):
                  try:
                      data = window.JSON.parse(content)
                      x_values = [str(item["x"]) for item in data]
                      y_values = [str(item["y"]) for item in data]
                      document["xValues"].value = ", ".join(x_values)
                      document["yValues"].value = ", ".join(y_values)
                      create_graph_data(None)
                  except Exception as e:
                      alert(f"Error parsing JSON: {str(e)}")
              else:
                  alert("Unsupported file type.")
          reader.bind("load", onload)
          reader.readAsText(file)

      # Analyze data
      def analyze_data(event):
          try:
              y_vals = [float(pt["y"]) for pt in window.dataPoints]
              n = len(y_vals)
              mean_val = sum(y_vals) / n
              sorted_y = sorted(y_vals)
              median_val = sorted_y[n//2] if n % 2 else (sorted_y[n//2 - 1] + sorted_y[n//2]) / 2
              std_dev = math.sqrt(sum((y - mean_val)**2 for y in y_vals) / n)
              document["analysisResults"].text = f"Mean: {mean_val:.2f}\nMedian: {median_val:.2f}\nStd Dev: {std_dev:.2f}"
          except Exception:
              alert("Data analysis requires numeric Y values.")

      # Add regression line
      def add_regression_line(event):
          try:
              x_vals = [float(pt["x"]) for pt in window.dataPoints]
              y_vals = [float(pt["y"]) for pt in window.dataPoints]
              n = len(x_vals)
              sum_x, sum_y = sum(x_vals), sum(y_vals)
              sum_xy = sum(x * y for x, y in zip(x_vals, y_vals))
              sum_x2 = sum(x * x for x in x_vals)
              slope = (n * sum_xy - sum_x * sum_y) / (n * sum_x2 - sum_x**2)
              intercept = (sum_y - slope * sum_x) / n
              reg_points = [{"x": min(x_vals), "y": slope * min(x_vals) + intercept},
                            {"x": max(x_vals), "y": slope * max(x_vals) + intercept}]
              window.chart.data.datasets.append({
                  "label": "Regression Line",
                  "data": reg_points,
                  "borderColor": "rgba(255, 99, 132, 1)",
                  "borderWidth": 2,
                  "pointRadius": 0,
                  "fill": False
              })
              window.chart.update()
          except Exception:
              alert("Regression requires numeric data.")

      # Add annotation
      def add_annotation(event):
          try:
              x_val = float(document["annotationX"].value.strip())
              label = document["annotationLabel"].value.strip()
              chart = window.chart
              if "annotation" not in chart.options.plugins:
                  chart.options.plugins.annotation = {"annotations": {}}
              key = f"annotation{len(chart.options.plugins.annotation.annotations) + 1}"
              chart.options.plugins.annotation.annotations[key] = {
                  "type": "line",
                  "scaleID": "x",
                  "value": x_val,
                  "borderColor": "red",
                  "borderWidth": 2,
                  "label": {"content": label, "enabled": True, "position": "start"}
              }
              chart.update()
          except Exception:
              alert("Invalid annotation X value.")

      # View data table
      def view_data_table(event):
          try:
              container = document["dataTableContainer"]
              if container.style.display == "none":
                  html = "<table class='table table-dark'><thead><tr><th>#</th><th>X</th><th>Y</th></tr></thead><tbody>"
                  for i, pt in enumerate(window.dataPoints):
                      html += f"<tr><td>{i+1}</td><td>{pt['x']}</td><td>{pt['y']}</td></tr>"
                  html += "</tbody></table>"
                  container.innerHTML = html
                  container.style.display = "block"
              else:
                  container.style.display = "none"
          except Exception:
              alert("No data to display.")

      # Download CSV
      def download_csv(event):
          try:
              csv_str = "x,y\n" + "\n".join(f"{pt['x']},{pt['y']}" for pt in window.dataPoints)
              blob = window.Blob.new([csv_str], {"type": "text/csv"})
              a = document.createElement("a")
              a.href = window.URL.createObjectURL(blob)
              a.download = "data.csv"
              document.body.appendChild(a)
              a.click()
              document.body.removeChild(a)
          except Exception:
              alert("No data to download.")

      # Save chart config
      def save_config(event):
          config = {key: document[key].value for key in ["xValues", "yValues", "chartType", "chartTitle", "xAxisLabel", "yAxisLabel", "datasetColor", "borderColor", "xAxisType", "yAxisType"]}
          window.localStorage.setItem("chartConfig", json.dumps(config))
          alert("Chart configuration saved.")

      # Load chart config
      def load_config(event):
          config_str = window.localStorage.getItem("chartConfig")
          if config_str:
              config = json.loads(config_str)
              for key, value in config.items():
                  document[key].value = value
              alert("Chart configuration loaded.")
          else:
              alert("No saved configuration.")

      # Update equation with sliders
      def update_equation_with_params(event):
          a, b, c = document["paramA"].value, document["paramB"].value, document["paramC"].value
          document["equation"].value = f"{a}*x**2 + {b}*x + {c}"
          create_graph_equation(event)

      # Update slider displays
      def update_slider_display(event):
          target = event.target
          document[f"{target.id}Value"].text = target.value

      # Toggle equation type inputs
      def toggle_additional_inputs(event):
          eq_type = document["equationType"].value
          document["parametricInputs"].style.display = "block" if eq_type == "parametric" else "none"
          
          # If implicit is selected, show the external program instead of the normal inputs
          if eq_type == "implicit":
              document["implicitInput"].style.display = "none"
              show_implicit_program()
          else:
              document["implicitInput"].style.display = "block" if eq_type == "implicit" else "none"
      
      # Show the implicit function program with animation
      def show_implicit_program():
          # Get the iframe and loading elements
          implicit_frame = document["implicitProgramFrame"]
          loading_indicator = document["loadingIndicator"]
          
          # Show the loading indicator
          loading_indicator.classList.remove("loading-hidden")
          
          # Set up the overlay first
          overlay = document["implicitProgramOverlay"]
          overlay.classList.remove("fade-out")
          overlay.style.display = "block"
          
          # Define the iframe load handler
          def on_frame_load(evt):
              # Hide loading indicator when frame is loaded
              loading_indicator.classList.add("loading-hidden")
          
          def on_frame_error(evt):
              alert("Failed to load the implicit function program. Please check the URL.")
              hide_implicit_program()
          
          # Bind the load and error events
          implicit_frame.bind("load", on_frame_load)
          implicit_frame.bind("error", on_frame_error)
          
          # Use setTimeout to ensure display is applied before animation
          def show_animation():
              overlay.classList.add("fade-in")
              # Apply body styles to prevent scrolling while overlay is shown
              document.body.style.overflow = "hidden"
              
              # Set the iframe source after the overlay is visible
              # Use a direct URL to the external content
              implicit_frame.src = "https://absaraltaf123.github.io/absar-/filetype.html"
          
          window.setTimeout(show_animation, 10)
      
      # Hide the implicit function program with animation
      def hide_implicit_program(event=None):
          overlay = document["implicitProgramOverlay"]
          implicit_frame = document["implicitProgramFrame"]
          
          # Clear the iframe source to stop any running processes
          implicit_frame.src = ""
          
          overlay.classList.remove("fade-in")
          overlay.classList.add("fade-out")
          
          # Restore body scrolling
          document.body.style.overflow = ""
          
          # After animation completes, hide the overlay
          def hide_overlay():
              overlay.style.display = "none"
              document["loadingIndicator"].classList.remove("loading-hidden")
          
          window.setTimeout(hide_overlay, 500)  # Match the animation duration (0.5s)
          
          # Reset equation type to explicit
          document["equationType"].value = "explicit"
          document["parametricInputs"].style.display = "none"
          document["implicitInput"].style.display = "none"

      # Plot additional equations
      def plot_additional_equation(event):
          eq_type = document["equationType"].value
          if eq_type == "explicit":
              create_graph_equation(event)
          elif eq_type == "parametric":
              x_eq, y_eq = document["parametricX"].value.strip(), document["parametricY"].value.strip()
              start_t, end_t = document["startT"].value.strip() or "0", document["endT"].value.strip() or "6.28"
              try:
                  start_t, end_t = float(start_t), float(end_t)
                  if start_t >= end_t:
                      raise ValueError
                  t_values = [start_t + i * (end_t - start_t) / 100 for i in range(101)]
                  data_points = []
                  for t in t_values:
                      x = eval(x_eq, {"__builtins__": None, "math": math, "t": t})
                      y = eval(y_eq, {"__builtins__": None, "math": math, "t": t})
                      data_points.append({"x": x, "y": y})
                  clear_chart()
                  ctx = document["myChart"].getContext("2d")
                  config = build_chart_config(data_points, "Parametric Equation")
                  window.chart = window.Chart.new(ctx, config)
                  window.dataPoints = data_points
                  apply_transform_animation()
              except Exception:
                  alert("Invalid parametric input.")
          elif eq_type == "implicit":
              eq = document["implicitEquation"].value.strip()
              start_x, end_x = document["startXImplicit"].value.strip() or "-10", document["endXImplicit"].value.strip() or "10"
              start_y, end_y = document["startY"].value.strip() or "-10", document["endY"].value.strip() or "10"
              try:
                  start_x, end_x, start_y, end_y = map(float, [start_x, end_x, start_y, end_y])
                  x_vals = [start_x + i * (end_x - start_x) / 50 for i in range(51)]
                  y_vals = [start_y + i * (end_y - start_y) / 50 for i in range(51)]
                  data_points = []
                  for x in x_vals:
                      for y in y_vals:
                          if abs(eval(eq, {"__builtins__": None, "math": math, "x": x, "y": y})) < 0.1:
                              data_points.append({"x": x, "y": y})
                  clear_chart()
                  ctx = document["myChart"].getContext("2d")
                  config = build_chart_config(data_points, "Implicit Equation")
                  window.chart = window.Chart.new(ctx, config)
                  window.dataPoints = data_points
                  apply_transform_animation()
              except Exception:
                  alert("Invalid implicit input.")

      # Handle tab switching
      def on_tab_change(ev):
          target_id = ev.target.getAttribute("data-target")
          for panel in ["#dataPanel", "#equationPanel"]:
              document.querySelector(panel).classList.toggle("active", panel == target_id)
          for btn in document.querySelectorAll(".custom-nav button"):
              btn.classList.toggle("active", btn.getAttribute("data-target") == target_id)
          document["moreOptionsContainer"].style.display = "block" if target_id == "#dataPanel" else "none"
          clear_chart()

      # Bind events
      document["createBtn"].bind("click", create_graph_data)
      document["createEquationBtn"].bind("click", create_graph_equation)
      document["clearDataBtn"].bind("click", lambda ev: clear_chart())
      document["clearEquationBtn"].bind("click", lambda ev: clear_chart())
      document["trigFunction"].bind("change", insert_trig_function)
      document["exportBtn"].bind("click", export_graph)
      document["resetZoomBtn"].bind("click", reset_zoom)
      document["dataFileInput"].bind("change", import_data)
      document["analyzeDataBtn"].bind("click", analyze_data)
      document["addRegressionBtn"].bind("click", add_regression_line)
      document["addAnnotationBtn"].bind("click", add_annotation)
      document["viewDataTableBtn"].bind("click", view_data_table)
      document["downloadCSVBtn"].bind("click", download_csv)
      document["saveConfigBtn"].bind("click", save_config)
      document["loadConfigBtn"].bind("click", load_config)
      document["updateEquationWithParams"].bind("click", update_equation_with_params)
      document["paramA"].bind("input", update_slider_display)
      document["paramB"].bind("input", update_slider_display)
      document["paramC"].bind("input", update_slider_display)
      document["equationType"].bind("change", toggle_additional_inputs)
      document["plotAdditionalBtn"].bind("click", plot_additional_equation)
      document["data-tab"].bind("click", on_tab_change)
      document["equation-tab"].bind("click", on_tab_change)
      document["implicitBackBtn"].bind("click", hide_implicit_program)
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
