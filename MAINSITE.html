<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mind Mapp - Immersive Experience</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Bangers&family=Luckiest+Guy&family=Nunito:wght@400;700&display=swap');

        :root {
            /* --- Core Configuration --- */
            --node-container-size: clamp(320px, 85vw, 480px); /* Slightly larger interactive area */
            --node-distance-factor: 0.36;
            --linkage-width: 2.5px; /* Slightly thicker for visual presence */
            --link-draw-duration: 0.9s;
            --node-appear-duration: 1.1s;
            --content-fade-duration: 0.9s;

            /* --- Immersive Color Palette --- */
            --bg-color: #030610; /* Even deeper, more cosmic blue */
            --bg-gradient: radial-gradient(ellipse at center, #0a1022 0%, #030610 75%);

            --particle-color-1: rgba(76, 197, 255, 0.6); /* Brighter Sky Blue */
            --particle-color-2: rgba(120, 123, 255, 0.6); /* Brighter Indigo */
            --particle-color-3: rgba(190, 160, 255, 0.6); /* Brighter Violet */
            --particle-connection-opacity: 0.15; /* More subtle connections */
            --particle-glow-intensity: 0.1; /* For mouse interaction glow */

            /* Wonder-inspired colors for animation elements */
            --wonder-pink: #ff70b8;
            --wonder-light-blue: #60d8f0;
            --wonder-purple: #d8a0ff;
            --wonder-orange: #ffc060;
            --wonder-yellow: #ffea68;
            --wonder-greenish: #80f0c8;
            --wonder-dark-text: #081c2b;
            --wonder-black-outline: #000000;
            --wonder-white-text: #ffffff;
            --wonder-line-color: rgba(240, 240, 255, 0.85);
            --wonder-pulse-color: rgba(255, 255, 255, 1); /* Brighter pulse */
            --center-pulse-color: rgba(173, 216, 230, 0.5); /* Light blue for center energy pulse */


            /* Premium UI Colors */
            --text-color-light: #f8fafc;
            --text-color-medium: rgba(226, 232, 240, 0.7);
            --text-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);

            --button-grad-start: #25a5f8; /* More vibrant */
            --button-grad-end: #5a61f1;
            --button-shadow: rgba(37, 165, 248, 0.35);
            --button-glow: rgba(90, 97, 241, 0.2);

            /* Premium node gradients (for logo icon) */
            --node-color-1a: #25a5f8;
            --node-color-1b: #5a61f1;
            --node-bg-gradient-1: linear-gradient(145deg, var(--node-color-1a), var(--node-color-1b));
            --node-shadow-1: rgba(90, 97, 241, 0.45);
            --node-glow-1: rgba(37, 165, 248, 0.3);
        }

        /* --- Base Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        html, body { height: 100%; width: 100%; overflow: hidden; background: var(--bg-gradient); color: var(--text-color-light); }

        /* --- Layout & Canvas --- */
        .splash-screen {
            position: fixed; inset: 0; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 100;
            opacity: 1; transition: opacity 1s ease-in-out; padding: 20px;
            background: var(--bg-gradient); perspective: 1200px; /* Enhanced perspective */
        }
        .splash-screen.hidden { opacity: 0; pointer-events: none; }
        #particleCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 101; pointer-events: none; }

        .parallax-container {
            position: relative; z-index: 105; will-change: transform;
            transition: transform 0.15s linear; /* Smoother parallax */
            display: flex; flex-direction: column; align-items: center;
            transform-style: preserve-3d; /* Enable 3D for children */
        }

        /* --- Logo --- */
        .logo-container {
            position: relative; margin-bottom: clamp(25px, 6vh, 45px); z-index: 110;
            display: flex; align-items: center; opacity: 0;
            transform: translateZ(20px); /* Slight 3D lift */
        }
        .logo-icon-wrapper {
            font-size: clamp(2.2rem, 6.5vw, 2.8rem);
            background: var(--node-bg-gradient-1);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px var(--node-glow-1));
            opacity: 0; transform: scale(0) rotate(-45deg); /* Start rotated */
            will-change: transform, opacity; margin-right: clamp(10px, 2.2vw, 15px);
        }
        .logo-text { display: flex; }
        .logo-text-word { display: flex; margin: 0 clamp(1.5px, 0.6vw, 4px); }
        .logo-text-word .letter {
            font-family: 'Bangers', cursive;
            font-size: clamp(2rem, 8vw, 3.2rem);
            color: var(--wonder-white-text);
            text-shadow:
                -1.5px -1.5px 0 var(--wonder-black-outline), 1.5px -1.5px 0 var(--wonder-black-outline),
                -1.5px 1.5px 0 var(--wonder-black-outline), 1.5px 1.5px 0 var(--wonder-black-outline),
                0 0 12px var(--wonder-purple), 3px 3px 0 var(--wonder-purple);
            opacity: 0;
            transform: translateY(20px) scale(0.6) rotateX(-80deg) rotateY(15deg); /* More dynamic entry */
            transition: opacity 0.5s ease-out, transform 0.7s cubic-bezier(0.165, 0.84, 0.44, 1.2); /* Bouncier */
            display: inline-block; will-change: transform, opacity;
        }
        .logo-text-word .letter.visible {
            opacity: 1; transform: translateY(0px) scale(1) rotateX(0deg) rotateY(0deg);
        }

        /* --- Wonder Mind Map Animation Area --- */
        .wonder-animation-area {
            position: relative;
            width: var(--node-container-size); height: var(--node-container-size);
            display: flex; justify-content: center; align-items: center;
            margin-bottom: clamp(25px, 5vh, 40px);
            transform-style: preserve-3d; /* Crucial for 3D children interactions */
            will-change: transform;
            transition: transform 0.2s ease-out; /* For mouse-based tilt */
        }
        /* Center Energy Pulse */
        .center-energy-pulse {
            position: absolute;
            width: 10px; height: 10px;
            background-color: var(--center-pulse-color);
            border-radius: 50%;
            opacity: 0;
            transform: scale(0);
            pointer-events: none;
            box-shadow: 0 0 20px 10px var(--center-pulse-color), 0 0 30px 15px rgba(200,220,255,0.3);
        }


        /* Pencil Icon (Wonder) */
        .pencil-icon {
            font-size: clamp(3.2rem, 8.5vw, 5.5rem);
            position: absolute; z-index: 115;
            filter: drop-shadow(3.5px 3.5px 0px var(--wonder-black-outline));
            opacity: 0;
            transform: translateX(-120vw) translateY(-60vh) rotate(-130deg) scale(0.4);
            will-change: transform, opacity;
            text-shadow: 0 0 8px rgba(255,255,255,0.3); /* Subtle glow on pencil */
        }
        @keyframes wonderPencilHover {
            0%, 100% { transform: translateY(0px) rotate(-5deg) translateZ(5px); } /* Added Z for 3D feel */
            50% { transform: translateY(-10px) rotate(5deg) translateZ(15px); }
        }
        @keyframes wonderPencilWriteTap { /* More pronounced tap */
            0% { transform: scale(1) rotate(0deg) translateZ(5px); }
            40% { transform: scale(1.2) rotate(-12deg) translateY(-6px) translateZ(20px); }
            100% { transform: scale(1) rotate(0deg) translateZ(5px); }
        }

        /* Idea Bubbles (Wonder) */
        .idea-bubble {
            position: absolute;
            border: 3.5px solid var(--wonder-black-outline);
            border-radius: clamp(22px, 5.5vw, 33px);
            padding: clamp(12px, 2.2vw, 20px);
            width: clamp(170px, 42vw, 220px);
            box-shadow: 7px 7px 0px rgba(0,0,0,0.28), 0 0 18px rgba(0,0,0,0.18);
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.05) rotateZ(var(--initial-spin, 0deg)) translateZ(-50px); /* Start further back */
            left: 50%; top: 50%;
            transition: opacity 0.9s ease-out, transform 0.9s cubic-bezier(0.22, 1.5, 0.5, 1.1); /* More expressive pop */
            will-change: transform, opacity; z-index: 110;
            transform-style: preserve-3d; /* For 3D children like text */
        }
        .idea-bubble::before { /* Inner subtle glow/highlight */
            content: ''; position: absolute;
            top: 5px; left: 5px; right: 5px; bottom: 5px;
            border-radius: ‡§á‡§®‡•ç‡§π‡•á‡§∞‡§ø‡§ü inherit; /* Match parent */
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15), transparent 70%);
            opacity: 0; transition: opacity 0.5s ease-out;
        }
        .idea-bubble.visible::before { opacity: 1; }

        .idea-bubble.visible { opacity: 1; /* transform set by JS */ }
        .idea-bubble.idle-float { animation: wonderIdleFloat 4.5s ease-in-out infinite var(--float-delay, 0s); }
        @keyframes wonderIdleFloat {
            0%, 100% { transform: translate(var(--tx), var(--ty)) scale(1) rotateZ(0deg) translateZ(0px); }
            25% { transform: translate(var(--tx), calc(var(--ty) - 7px)) scale(1.03) rotateZ(-1.8deg) translateZ(5px); }
            75% { transform: translate(var(--tx), calc(var(--ty) + 3.5px)) scale(0.98) rotateZ(1.8deg) translateZ(-2px); }
        }
        .bubble-header {
            background-color: var(--wonder-white-text);
            border: 2.5px solid var(--wonder-black-outline);
            border-radius: clamp(12px, 3.3vw, 16px);
            padding: clamp(6px, 1.6vw, 9px) clamp(9px, 2.2vw, 15px);
            margin-bottom: clamp(10px, 2.2vh, 16px);
            display: flex; align-items: center; box-shadow: inset 0 0 5px rgba(0,0,0,0.12);
            transform: translateZ(5px); /* Lift header slightly */
        }
        .bubble-number { /* ... (mostly same, slightly larger) ... */
            font-size: clamp(0.9em, 2.8vw, 1.1em); width: clamp(26px, 6.5vw, 32px); height: clamp(26px, 6.5vw, 32px);
            background-color: var(--wonder-purple); color: var(--wonder-white-text); font-family: 'Luckiest Guy', cursive;
            border-radius: 50%; display: inline-flex; justify-content: center; align-items: center;
            margin-right: clamp(9px, 2.2vw, 13px); border: 1.8px solid var(--wonder-black-outline);
            box-shadow: inset 1.5px 1.5px 2.5px rgba(0,0,0,0.22), 0 0 5px var(--wonder-purple);
        }
        .bubble-title { /* ... (mostly same) ... */
            font-weight: 700; color: var(--wonder-dark-text); font-size: clamp(0.85em, 3vw, 1.05em);
        }
        .bubble-text { /* ... (mostly same) ... */
            font-size: clamp(0.75em, 2.4vw, 0.9em); color: var(--wonder-dark-text); line-height: 1.5;
            transform: translateZ(2px); /* Slight depth for text */
        }
        /* Specific bubble colors are fine */

        /* Connecting Lines (Wonder) */
        .connecting-line-wrapper { /* ... (mostly same) ... */
            position: absolute; left: 50%; top: 50%;
            height: clamp(3px, 0.7vw, 4px);
            transform-origin: 0% 50%; z-index: 108;
            will-change: transform;
        }
        .connecting-line { /* ... (mostly same, more vibrant pulse) ... */
            width: 100%; height: 100%; background-color: var(--wonder-line-color);
            transform: scaleX(0); transform-origin: 0% 50%; border-radius: 2.5px;
            transition: transform 0.8s cubic-bezier(0.7, 0, 0.3, 1) 0.15s; /* Smoother, more deliberate draw */
            position: relative; overflow: hidden;
            box-shadow: 0 0 5px rgba(220,220,255,0.3); /* Subtle glow on the line itself */
        }
        .connecting-line.visible { transform: scaleX(1); }
        .connecting-line::after { /* Pulse element */
            content: ''; position: absolute; top: -1.5px; left: 0; width: 18px; height: calc(100% + 3px);
            background-color: var(--wonder-pulse-color); border-radius: 2.5px;
            box-shadow: 0 0 10px var(--wonder-pulse-color), 0 0 15px var(--wonder-white-text); /* Stronger pulse glow */
            opacity: 0; transform: translateX(-100%);
            animation: wonderLinePulse 1.3s cubic-bezier(0.45, 0, 0.55, 1) forwards;
            will-change: transform, opacity;
        }
        /* ... (Keyframes and other styles mostly same, ensure namespacing if conflicts) ... */

        /* Decorative Icons (Wonder) */
        .decorative-icon {
            font-size: clamp(2rem, 5vw, 3.2rem); opacity: 0;
            transform: scale(0) rotate(var(--initial-deco-rotate, 0deg)) translateY(50px) translateZ(-30px); /* More 3D entry */
            transition: opacity 0.8s ease-out, transform 0.8s cubic-bezier(0.165, 0.84, 0.44, 1.2);
            filter: drop-shadow(2.5px 2.5px 0px var(--wonder-black-outline));
            will-change: transform, opacity; z-index: 109;
            text-shadow: 0 0 5px rgba(255,255,255,0.2);
        }
        /* ... (Rest of decorative icon styles and keyframes are good) ... */

        /* --- UI Elements (Premium) --- */
        .bottom-content { /* ... (mostly same) ... */
            position: relative; z-index: 120; display: flex; flex-direction: column; align-items: center;
            width: 100%; max-width: clamp(320px, 90vw, 480px);
            transform: translateZ(30px); /* Lift UI slightly */
        }
        .tag-line { /* ... (Catchier text to be set in HTML/JS) ... */
            font-size: clamp(1.05rem, 3.8vw, 1.3rem); font-weight: 500; /* Slightly bolder */
            color: var(--text-color-medium); text-align: center;
            margin-bottom: clamp(1.6rem, 4.5vh, 2.2rem); letter-spacing: 0.5px;
            opacity: 0; transform: translateY(30px); text-shadow: var(--text-shadow);
            will-change: transform, opacity;
        }
        /* ... (Button, Credit, Frame styles largely the same, ensure responsiveness with clamp) ... */
        .enter-app {
             padding: clamp(13px, 3.3vh, 17px) clamp(35px, 9vw, 50px);
             font-size: clamp(1.05rem, 3.8vw, 1.3rem);
             /* other styles fine */
        }
        .designer-credit { font-size: clamp(0.75rem, 2.2vw, 0.85rem); }


        /* --- Frame Container --- */
        .frame-container {
            position: fixed; inset: 0; z-index: 50; opacity: 0; pointer-events: none;
            transition: opacity 1s ease-in-out 0.4s; /* Slightly longer fade for iframe */
            background-color: #f0f4f8; /* Lighter background for app frame */
        }
        .frame-container.visible { opacity: 1; pointer-events: auto; }
        iframe { width: 100%; height: 100%; border: none; background-color: transparent; }

    </style>
</head>
<body>

<div class="splash-screen">
    <canvas id="particleCanvas"></canvas>

    <div class="parallax-container">
        <div class="logo-container">
            <div class="logo-icon-wrapper">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="1em" height="1em">
                     <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/>
                     <circle cx="12" cy="12" r="2.5"/>
                 </svg>
            </div>
            <div class="logo-text">
                <div class="logo-text-word" id="logoWordMind"></div>
                <div class="logo-text-word" id="logoWordMapp"></div>
            </div>
        </div>

        <div class="wonder-animation-area" id="wonderAnimationArea">
            <div class="center-energy-pulse" id="centerPulse"></div>
            <div class="pencil-icon" id="pencilIconMain">‚úèÔ∏è</div>
            <!-- Bubbles -->
            <div class="idea-bubble" id="bubble-1" data-text="Ignite innovation. Map your brilliance.">
                <div class="bubble-header"><span class="bubble-number">1</span><span class="bubble-title">SPARK IDEAS</span></div>
                <div class="bubble-text"></div>
            </div>
            <div class="idea-bubble" id="bubble-2" data-text="Connect concepts with cosmic clarity.">
                <div class="bubble-header"><span class="bubble-number">2</span><span class="bubble-title">LINK THOUGHTS</span></div>
                <div class="bubble-text"></div>
            </div>
            <div class="idea-bubble" id="bubble-3" data-text="Forge pathways to profound understanding.">
                <div class="bubble-header"><span class="bubble-number">3</span><span class="bubble-title">BUILD VISIONS</span></div>
                <div class="bubble-text"></div>
            </div>
            <div class="idea-bubble" id="bubble-4" data-text="Illuminate the universe of your mind.">
                <div class="bubble-header"><span class="bubble-number">4</span><span class="bubble-title">BRIGHTEN INSIGHTS</span></div>
                <div class="bubble-text"></div>
            </div>
            <div class="idea-bubble" id="bubble-5" data-text="Simplify complexity, amplify genius.">
                <div class="bubble-header"><span class="bubble-number">5</span><span class="bubble-title">EASY & ELEGANT</span></div>
                <div class="bubble-text"></div>
            </div>
            <div class="idea-bubble" id="bubble-6" data-text="Chart new territories of thought.">
                <div class="bubble-header"><span class="bubble-number">6</span><span class="bubble-title">MODERN MINDSCAPES</span></div>
                <div class="bubble-text"></div>
            </div>
            <!-- Decorative Icons -->
            <div class="decorative-icon star-spin" id="decoStar1">üåü</div>
            <div class="decorative-icon star-spin" id="decoStar2">‚ú®</div>
            <div class="decorative-icon lightbulb-flicker" id="decoLightbulb">üí°</div>
            <div class="decorative-icon" id="decoMagnify">üîé</div>
        </div>
    </div>

    <div class="bottom-content">
        <div class="tag-line">Mind Mapp: Where Ideas Take Flight.</div>
        <button class="enter-app">Launch Your Universe</button>
        <p class="designer-credit">Immersive Interface by Absar Altaf Shah</p>
    </div>
</div>

<div class="frame-container">
    <iframe src="https://absar-jet.vercel.app/mind%20map.html" title="Mind Map Creator" sandbox="allow-same-origin allow-scripts allow-popups allow-forms"></iframe>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Element Caching ---
    const splashScreen = document.querySelector('.splash-screen');
    const frameContainer = document.querySelector('.frame-container');
    const canvasEl = document.getElementById('particleCanvas');
    const ctx = canvasEl.getContext('2d');
    const parallaxContainer = document.querySelector('.parallax-container');
    const logoContainer = document.querySelector('.logo-container');
    const logoIconWrapper = logoContainer.querySelector('.logo-icon-wrapper');
    const logoWordMindEl = document.getElementById('logoWordMind');
    const logoWordMappEl = document.getElementById('logoWordMapp');
    const enterButton = document.querySelector('.enter-app');
    const tagLine = document.querySelector('.tag-line');
    const designerCredit = document.querySelector('.designer-credit');
    const wonderAnimationArea = document.getElementById('wonderAnimationArea');
    const centerPulseEl = document.getElementById('centerPulse');
    const pencilMain = document.getElementById('pencilIconMain');
    const bubbles = gsap.utils.toArray('.idea-bubble');
    const decorativeIcons = gsap.utils.toArray('.decorative-icon');

    // --- Config & State ---
    const CONFIG = {
        particleColors: [ /* Read from CSS or define here */ ],
        particleConnectionOpacity: 0.15,
        particleInteractionRadius: 120, // Radius for mouse to affect particles
        particleAttractForce: 0.003,   // Force pulling particles to mouse
        particleRepelForce: 0.008,    // Force pushing particles from mouse (stronger)
        nodeContainerSize: () => parseFloat(getComputedStyle(wonderAnimationArea).width),
        nodeDistanceFactor: 0.37, // Slightly increased distance
        soundEnabled: false // Conceptual - Set to true to see console logs
    };
    CONFIG.particleColors = [getComputedStyle(document.documentElement).getPropertyValue('--particle-color-1').trim(), /* ... more */];
    const numBubbles = bubbles.length;
    let particles = [];
    let canvasWidth = window.innerWidth, canvasHeight = window.innerHeight;
    let particleRAFId, parallaxRAFId;
    let mouse = { x: canvasWidth/2, y: canvasHeight/2, isDown: false };
    let isLoadingComplete = false, introAnimationComplete = false;

    // --- Enhanced Particle System ---
    class Particle {
        constructor() { this.reset(); this.baseSize=Math.random()*1.8+0.6; this.alpha=Math.random()*0.5+0.2; this.targetAlpha=this.alpha; this.vx=Math.random()*0.3-0.15; this.vy=Math.random()*0.3-0.15; this.maxSpeed = 0.8; }
        reset(){ this.x=Math.random()*canvasWidth; this.y=Math.random()*canvasHeight; this.color=CONFIG.particleColors[Math.floor(Math.random()*CONFIG.particleColors.length)]; this.connections=[]; this.connectionDistance=Math.random()*90+80;}
        update(mousePos){
            const dxMouse=this.x-mousePos.x; const dyMouse=this.y-mousePos.y;
            const distMouse=Math.sqrt(dxMouse*dxMouse+dyMouse*dyMouse);
            let forceFactor = 0;
            if (distMouse < CONFIG.particleInteractionRadius) {
                // Stronger repulsion when mouse is down (simulating a push)
                const baseForce = mousePos.isDown ? CONFIG.particleRepelForce : CONFIG.particleAttractForce;
                forceFactor = (1 - distMouse / CONFIG.particleInteractionRadius) * baseForce;
                if (!mousePos.isDown) forceFactor *= -1; // Attract if mouse is not down
            }
            this.vx += (dxMouse/distMouse)*forceFactor*10; // Multiplier for stronger effect
            this.vy += (dyMouse/distMouse)*forceFactor*10;

            if(Math.random()<0.03){this.vx+=(Math.random()*0.15-0.075);this.vy+=(Math.random()*0.15-0.075);}
            const speed = Math.sqrt(this.vx*this.vx + this.vy*this.vy);
            if (speed > this.maxSpeed) { this.vx = (this.vx/speed) * this.maxSpeed; this.vy = (this.vy/speed) * this.maxSpeed; }
            this.x+=this.vx; this.y+=this.vy; this.vx*=0.97; this.vy*=0.97; // Slightly less damping for longer trails
            // Boundary and alpha logic (similar to before)
            const edgeThreshold=30; let targetAlpha=this.targetAlpha; if(this.x<edgeThreshold||this.x>canvasWidth-edgeThreshold||this.y<edgeThreshold||this.y>canvasHeight-edgeThreshold){targetAlpha=Math.min(this.alpha,Math.max(0,this.alpha*(1-Math.abs(this.x-canvasWidth/2)/(canvasWidth/2-edgeThreshold))),Math.max(0,this.alpha*(1-Math.abs(this.y-canvasHeight/2)/(canvasHeight/2-edgeThreshold))))*0.4;} this.alpha+=(targetAlpha-this.alpha)*0.06; if(this.x<-20)this.x=canvasWidth+20; if(this.x>canvasWidth+20)this.x=-20; if(this.y<-20)this.y=canvasHeight+20; if(this.y>canvasHeight+20)this.y=-20;
        }
        draw(ctx){ /* ... same ... */ if(this.alpha<=0.01)return; ctx.beginPath(); ctx.arc(this.x,this.y,this.baseSize,0,Math.PI*2); const colorMatch=this.color.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/); if(colorMatch){ctx.fillStyle=`rgba(${colorMatch[1]},${colorMatch[2]},${colorMatch[3]},${this.alpha})`;}else{ctx.fillStyle=this.color;} ctx.fill(); }
        findConnections(allParticles){ /* ... same ... */ this.connections=[]; for(let other of allParticles){ if(other===this||other.alpha<=0.01)continue; const dx=this.x-other.x; const dy=this.y-other.y; const distance=Math.sqrt(dx*dx+dy*dy); if(distance<this.connectionDistance){const opacity=(1-distance/this.connectionDistance)*Math.min(this.alpha,other.alpha)*CONFIG.particleConnectionOpacity; if(opacity>0.01){this.connections.push({other,opacity});}}} }
        drawConnections(ctx){ /* ... same ... */ if(this.alpha<=0.01)return; for(let conn of this.connections){ if(conn.opacity<=0.01)continue; ctx.beginPath(); ctx.moveTo(this.x,this.y); ctx.lineTo(conn.other.x,conn.other.y); const colorMatch=this.color.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/); if(colorMatch){ctx.strokeStyle=`rgba(${colorMatch[1]},${colorMatch[2]},${colorMatch[3]},${conn.opacity})`;}else{ctx.strokeStyle=`rgba(200,200,255,${conn.opacity})`;} ctx.lineWidth=0.4; ctx.stroke();}}
    }
    function setupParticleCanvas() { /* ... same, but adjust particleCount if needed ... */
        canvasWidth = window.innerWidth; canvasHeight = window.innerHeight;
        canvasEl.width = canvasWidth; canvasEl.height = canvasHeight; particles = [];
        const particleCount = Math.min(Math.max(Math.floor((canvasWidth*canvasHeight)/15000),50),180); // Slightly more particles
        for (let i = 0; i < particleCount; i++) particles.push(new Particle());
        if (particleRAFId) cancelAnimationFrame(particleRAFId);
        animateParticles();
    }
    function animateParticles() { /* ... same ... */
        ctx.clearRect(0,0,canvasWidth,canvasHeight);
        const currentMouse = {x:mouse.x,y:mouse.y, isDown:mouse.isDown}; // Pass mouse state
        particles.forEach(p=>p.update(currentMouse)); particles.forEach(p=>p.findConnections(particles));
        particles.forEach(p=>p.drawConnections(ctx)); particles.forEach(p=>p.draw(ctx));
        particleRAFId = requestAnimationFrame(animateParticles);
    }

    // --- Sound Player (Conceptual) ---
    function playSound(soundName) { if (CONFIG.soundEnabled) console.log(`PLAY_SOUND: ${soundName}`); }

    // --- Wonder Animation Helpers ---
    function typeWriter(element, text, speed = 22) { /* ... same ... */ let i = 0; element.innerHTML = ""; function type() { if (i < text.length) { element.innerHTML += text.charAt(i); i++; setTimeout(type, speed + Math.random() * 18 - 9); } else {playSound('typing_done.mp3');} } playSound('typing_start.mp3'); type(); }
    function injectLetters(wordElement, text) { /* ... same ... */ text.split('').forEach(char => { const letterSpan = document.createElement('span'); letterSpan.classList.add('letter'); letterSpan.textContent = char; wordElement.appendChild(letterSpan); }); return wordElement.querySelectorAll('.letter'); }

    // --- Simulation of Loading ---
    function simulateLoading(callback) { /* ... same ... */ const loadTime = Math.random()*600+1000; setTimeout(()=>{isLoadingComplete=true; if(callback)callback();},loadTime); }

    // --- Main Animation Sequence ---
    function startIntroAnimation() {
        if (!isLoadingComplete) { setTimeout(startIntroAnimation, 100); return; }
        playSound('intro_start.mp3');
        const tl = gsap.timeline({ onComplete: () => { introAnimationComplete = true; playSound('intro_complete.mp3'); } });

        // 1. Logo (Icon + Text)
        tl.to(logoContainer, { opacity: 1, duration: 0.2 }, 0.1)
          .to(logoIconWrapper, { opacity: 1, scale: 1, rotation: 0, duration: 0.9, ease: "elastic.out(1, 0.5)" }, 0.3);
        playSound('logo_icon_appear.mp3');

        const lettersMind = injectLetters(logoWordMindEl, "Mind");
        const lettersMapp = injectLetters(logoWordMappEl, "Mapp");
        const allLogoLetters = [...lettersMind, ...lettersMapp];

        allLogoLetters.forEach((letter, i) => {
            tl.to(letter, {
                opacity: 1, y: 0, scale: 1, rotateX: 0, rotateY: 0,
                duration: 0.8, ease: "elastic.out(1, 0.45)",
                onStart: () => playSound('letter_pop.mp3')
            }, 0.5 + i * 0.06); // Faster stagger
        });

        // 2. Pencil swoops in
        const logoRect = logoContainer.getBoundingClientRect();
        const wonderAreaRect = wonderAnimationArea.getBoundingClientRect();
        const lastLetterMapp = lettersMapp[lettersMapp.length-1];
        const pencilTargetX = lastLetterMapp ? (lastLetterMapp.getBoundingClientRect().right - wonderAreaRect.left - pencilMain.offsetWidth*0.4) : (logoRect.right - wonderAreaRect.left - pencilMain.offsetWidth);
        const pencilTargetY = logoRect.top - wonderAreaRect.top + logoRect.height*0.4 - pencilMain.offsetHeight*0.6;

        tl.to(pencilMain, { x:pencilTargetX, y:pencilTargetY, rotation:-12, scale:1, opacity:1, duration:0.9, ease:"power3.out", onStart:()=>playSound('pencil_swoosh_1.mp3') }, ">-0.4")
          .call(() => { pencilMain.style.animation = 'wonderPencilHover 2.2s ease-in-out infinite'; }, [], ">");

        // 3. Center Energy Pulse before bubbles
        tl.to(centerPulseEl, { scale: 15, opacity: 1, duration: 0.4, ease: "power2.out", onStart: ()=>playSound('energy_pulse_charge.mp3') }, ">+0.3")
          .to(centerPulseEl, { opacity: 0, duration: 0.5, ease: "power2.in", onStart: ()=>playSound('energy_pulse_release.mp3') }, ">-0.2");


        // 4. Bubbles and Lines
        const currentContainerSize = CONFIG.nodeContainerSize();
        const radius = currentContainerSize * CONFIG.nodeDistanceFactor;
        const angleStep = 360 / numBubbles;

        bubbles.forEach((bubble, index) => {
            const angleRad = (angleStep * index - 90 + (360/numBubbles / 2)) * (Math.PI / 180); // Offset for better spacing
            const targetX = radius * Math.cos(angleRad);
            const targetY = radius * Math.sin(angleRad);

            const lineWrapper = document.createElement('div'); lineWrapper.classList.add('connecting-line-wrapper');
            const line = document.createElement('div'); line.classList.add('connecting-line');
            const distanceToBubble = Math.sqrt(targetX*targetX + targetY*targetY);
            lineWrapper.style.width = `${distanceToBubble}px`;
            lineWrapper.style.transform = `rotate(${angleStep*index - 90 + (360/numBubbles / 2)}deg)`;
            line.style.setProperty('--line-length', `${distanceToBubble}px`);
            lineWrapper.appendChild(line);
            wonderAnimationArea.insertBefore(lineWrapper, pencilMain); // Ensure correct layering

            tl.add(() => {
                const initialSpin = (Math.random() - 0.5) * 80;
                bubble.style.setProperty('--initial-spin', `${initialSpin}deg`);
                gsap.to(bubble, {
                    opacity: 1,
                    transform: `translate(calc(-50% + ${targetX}px), calc(-50% + ${targetY}px)) scale(1) rotateZ(0deg) translateZ(0px)`,
                    duration: CONFIG.nodeAppearDuration, ease: "elastic.out(1, 0.65)",
                    onStart: () => playSound('bubble_pop_out.mp3'),
                    onComplete: () => { /* ... (idle anim, typewriter) ... */
                        bubble.style.setProperty('--tx', `calc(-50% + ${targetX}px)`); bubble.style.setProperty('--ty', `calc(-50% + ${targetY}px)`);
                        bubble.style.setProperty('--float-delay', `${Math.random()*0.9}s`); bubble.classList.add('idle-float');
                        const textEl = bubble.querySelector('.bubble-text'); const textToType = bubble.dataset.text;
                        if(textEl && textToType) setTimeout(()=>typeWriter(textEl, textToType), 250);
                    }
                });
                setTimeout(() => { line.classList.add('visible'); playSound('line_draw.mp3'); setTimeout(() => line.classList.add('pulsing'), 550); }, 200);
            }, ">-=" + (CONFIG.nodeAppearDuration * 0.75 - index * 0.06) ); // More overlap
        });

        // 5. Decorative Icons
        decorativeIcons.forEach((icon, index) => {
            tl.add(() => { /* ... (same placement logic, slightly adjust random rotation) ... */
                const cRect = wonderAnimationArea.getBoundingClientRect(); let randX, randY, attempts = 0;
                const iconSize = Math.max(icon.offsetWidth, icon.offsetHeight);
                do { randX = (Math.random()*0.9+0.05)*cRect.width-cRect.width/2; randY = (Math.random()*0.9+0.05)*cRect.height-cRect.height/2; attempts++; } while (Math.sqrt(randX*randX + randY*randY) < radius * 0.35 && attempts < 10);
                icon.style.left=`calc(50% + ${randX}px - ${icon.offsetWidth/2}px)`; icon.style.top=`calc(50% + ${randY}px - ${icon.offsetHeight/2}px)`;
                const randomRotation = (Math.random()-0.5)*70; icon.style.setProperty('--random-rotate', `${randomRotation}deg`);
                icon.style.setProperty('--initial-deco-rotate', `${(Math.random()-0.5)*45}deg`);
                if(icon.classList.contains('star-spin')){icon.style.setProperty('--spin-delay', `${Math.random()*1.8}s`);}
                icon.classList.add('visible'); playSound('deco_icon_appear.mp3');
            }, ">-0.7");
        });

        // 6. Bottom Content
        tl.to([tagLine, enterButton, designerCredit], {
            visibility: "visible", opacity: 1, y: 0, duration: CONFIG.contentFadeDuration, stagger: 0.18, ease: "power3.out",
            onStart: () => playSound('ui_elements_fade_in.mp3')
        }, ">-0.4");
    }

    // --- Event Handlers ---
    function handleMouseMove(event) { mouse.x=event.clientX; mouse.y=event.clientY; if(!parallaxRAFId){parallaxRAFId=requestAnimationFrame(updateParallaxAndAreaTilt);} }
    function handleMouseDown() { mouse.isDown = true; playSound('mouse_down_effect.mp3'); }
    function handleMouseUp() { mouse.isDown = false; }

    function updateParallaxAndAreaTilt() {
        const offsetX = (mouse.x/window.innerWidth)-0.5; const offsetY = (mouse.y/window.innerHeight)-0.5;
        if(parallaxContainer){gsap.to(parallaxContainer,{x:offsetX*-30,y:offsetY*-30,rotationY:offsetX*5,rotationX:-offsetY*5,duration:0.5,ease:"power1.out",overwrite:true});}
        // Tilt animation area for more 3D
        if(wonderAnimationArea){gsap.to(wonderAnimationArea,{rotationY:offsetX*12,rotationX:-offsetY*12,transformOrigin:"center center -100px",duration:0.6,ease:"expo.out",overwrite:true});}
        parallaxRAFId=null;
    }
    function handleResize() { setupParticleCanvas(); /* More robust resize handling for bubble positions would be complex */ }
    function handleEnterApp() { /* ... (same, add sound) ... */
        if(!introAnimationComplete)return; playSound('button_click_enter_app.mp3');
        // ... rest of exit animation ...
        gsap.to(enterButton,{scale:0.95,duration:0.15,yoyo:true,repeat:1,ease:"power2.inOut"});
        gsap.to(splashScreen,{opacity:0,duration:1,ease:"power2.in",onComplete:()=>{
            splashScreen.classList.add('hidden');
            if(particleRAFId){cancelAnimationFrame(particleRAFId);particleRAFId=null;}
            if(parallaxRAFId){cancelAnimationFrame(parallaxRAFId);parallaxRAFId=null;}
            gsap.killTweensOf('.idea-bubble.idle-float'); gsap.killTweensOf('.decorative-icon');
            window.removeEventListener('mousemove',handleMouseMove); window.removeEventListener('mousedown', handleMouseDown); window.removeEventListener('mouseup', handleMouseUp);
            playSound('app_frame_load.mp3');
        }});
        frameContainer.classList.add('visible');
    }

    // --- Initialize ---
    function init() {
        gsap.set(logoContainer,{opacity:0}); gsap.set(logoIconWrapper,{scale:0,opacity:0,rotation:-45});
        gsap.set([tagLine,enterButton,designerCredit],{opacity:0,y:30,visibility:'hidden'});
        gsap.set(pencilMain,{opacity:0}); gsap.set(centerPulseEl, {opacity:0, scale:0});

        setupParticleCanvas();
        simulateLoading(startIntroAnimation);

        window.addEventListener('resize',handleResize);
        window.addEventListener('mousemove',handleMouseMove);
        window.addEventListener('mousedown', handleMouseDown);
        window.addEventListener('mouseup', handleMouseUp);
        enterButton.addEventListener('click',handleEnterApp);
    }

    init();
});
</script>

</body>
</html>
